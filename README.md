# è‚¡ç¥¨ä»·å€¼åˆ†æç³»ç»Ÿ

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://www.python.org/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.104+-green.svg)](https://fastapi.tiangolo.com/)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

ä¸€ä¸ªåŸºäº FastAPI çš„æ™ºèƒ½è‚¡ç¥¨ä»·å€¼åˆ†æç³»ç»Ÿ,ä¸“æ³¨äºç­›é€‰**ä½æ³¢åŠ¨ç‡ã€é«˜è‚¡æ¯ç‡ã€æœ‰æˆé•¿ä»·å€¼**çš„ä¼˜è´¨è‚¡ç¥¨ã€‚

---

## ğŸ“‘ ç›®å½•

- [åŠŸèƒ½ç‰¹æ€§](#-åŠŸèƒ½ç‰¹æ€§)
- [ç³»ç»Ÿæ¶æ„](#-ç³»ç»Ÿæ¶æ„)
- [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)
- [å®‰è£…éƒ¨ç½²](#-å®‰è£…éƒ¨ç½²)
- [ä½¿ç”¨æŒ‡å—](#-ä½¿ç”¨æŒ‡å—)
- [APIæ–‡æ¡£](#-apiæ–‡æ¡£)
- [æ•°æ®æ¨¡å‹](#-æ•°æ®æ¨¡å‹)
- [è¯„åˆ†ç³»ç»Ÿ](#-è¯„åˆ†ç³»ç»Ÿ)
- [å¸¸è§é—®é¢˜](#-å¸¸è§é—®é¢˜)
- [å¼€å‘æŒ‡å—](#-å¼€å‘æŒ‡å—)
- [æ›´æ–°æ—¥å¿—](#-æ›´æ–°æ—¥å¿—)

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

- âœ… **å¤šç”¨æˆ·æ”¯æŒ** - æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹çš„è‚¡ç¥¨å…³æ³¨åˆ—è¡¨
- âœ… **ä¸‰æ•°æ®æºç‹¬ç«‹å­˜å‚¨** - å¸‚åœºæ•°æ®/å†å²æ•°æ®/åˆ†çº¢æ•°æ®åˆ†ç¦»
- âœ… **è‡ªåŠ¨å®šæ—¶ä»»åŠ¡** - æ¯æ—¥è‡ªåŠ¨è·å–æ•°æ®å’Œåˆ†æ
- âœ… **æ™ºèƒ½è¯„åˆ†ç³»ç»Ÿ** - ç»¼åˆæ³¢åŠ¨ç‡ã€è‚¡æ¯ç‡ã€æˆé•¿æ€§ä¸‰ç»´åº¦è¯„åˆ†
- âœ… **å®Œæ•´å­—æ®µæ˜ å°„** - 20+å­—æ®µå®Œæ•´ä¿å­˜
- âœ… **æ‰¹é‡æ•°æ®è¡¥å……** - ä¸“ä¸šçš„å†å²æ•°æ®è¡¥å……å·¥å…·
- âœ… **çµæ´»å¯¼å‡ºåŠŸèƒ½** - å…¨å±€/ä¸ªäººCSVå¯¼å‡º

### æŠ€æœ¯ç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½** - æ‰¹é‡å¤„ç†,å¼‚æ­¥IO
- ğŸ”’ **æ•°æ®å®‰å…¨** - SQLiteæŒä¹…åŒ–å­˜å‚¨
- ğŸ“Š **å®æ—¶ç»Ÿè®¡** - å­—æ®µå®Œæ•´æ€§å®æ—¶ç›‘æ§
- ğŸ”„ **åŒæ•°æ®æº** - è‡ªåŠ¨åˆ‡æ¢,æé«˜æˆåŠŸç‡
- ğŸŒ **RESTful API** - æ ‡å‡†åŒ–æ¥å£è®¾è®¡
- ğŸ“± **è‡ªåŠ¨åŒ–** - å®šæ—¶ä»»åŠ¡,æ— éœ€äººå·¥å¹²é¢„

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æŠ€æœ¯æ ˆ

```
åç«¯æ¡†æ¶: FastAPI
æ•°æ®åº“: SQLite
æ•°æ®æº: AkShare + efinance
è°ƒåº¦å™¨: APScheduler
ORM: SQLAlchemy
å¼‚æ­¥å¤„ç†: asyncio
```

### æ•°æ®æµç¨‹

```
1. æ•°æ®è·å– (15:30)
   â”œâ”€ è°ƒç”¨ä¸œæ–¹è´¢å¯ŒAPI
   â”œâ”€ è·å–å…¨å¸‚åœº5000+è‚¡ç¥¨æ•°æ®
   â”œâ”€ å®Œæ•´å­—æ®µæ˜ å°„(20+å­—æ®µ)
   â””â”€ æ‰¹é‡ä¿å­˜åˆ°æ•°æ®åº“

2. å†å²æ•°æ®è¡¥å…… (æŒ‰éœ€)
   â”œâ”€ ä¼˜å…ˆä½¿ç”¨efinance
   â”œâ”€ å¤‡ç”¨akshare
   â”œâ”€ å‰å¤æƒæ•°æ®
   â””â”€ ä¿å­˜11ä¸ªå­—æ®µ

3. æ•°æ®åˆ†æ (16:00)
   â”œâ”€ è·å–å®æ—¶å¸‚åœºæ•°æ®
   â”œâ”€ è®¡ç®—æŠ€æœ¯æŒ‡æ ‡(æ³¢åŠ¨ç‡)
   â”œâ”€ è®¡ç®—è´¢åŠ¡æŒ‡æ ‡(ROE/å¢é•¿ç‡)
   â”œâ”€ è®¡ç®—è‚¡æ¯ç‡
   â”œâ”€ ç»¼åˆè¯„åˆ†
   â””â”€ ç”ŸæˆæŠ•èµ„å»ºè®®

4. ç»“æœå¯¼å‡º
   â”œâ”€ å…¨å±€å¯¼å‡º(æ‰€æœ‰è‚¡ç¥¨)
   â””â”€ ç”¨æˆ·å¯¼å‡º(å…³æ³¨è‚¡ç¥¨)
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Python 3.8+
- pip åŒ…ç®¡ç†å™¨

### 5åˆ†é’Ÿå¿«é€Ÿä½“éªŒ

```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. å¯åŠ¨æœåŠ¡
python main.py

# 3. è®¿é—®APIæ–‡æ¡£
æµè§ˆå™¨æ‰“å¼€: http://localhost:8000/docs

# 4. åˆ›å»ºç”¨æˆ·
curl -X POST "http://localhost:8000/users/create?user_id=demo&username=æ¼”ç¤ºç”¨æˆ·"

# 5. æ·»åŠ å…³æ³¨è‚¡ç¥¨
curl -X POST "http://localhost:8000/watch/add?user_id=demo&stock_codes=600036,000001,600519"

# 6. è·å–å¸‚åœºæ•°æ®
curl -X POST "http://localhost:8000/data/market/fetch?force=true"

# 7. è¡¥å……å†å²æ•°æ®
python supplement_history.py watch --mode full

# 8. æ‰§è¡Œåˆ†æ
curl -X POST "http://localhost:8000/analyze/manual"

# 9. å¯¼å‡ºç»“æœ
curl "http://localhost:8000/export/user?user_id=demo" --output result.csv
```

---

## ğŸ“¦ å®‰è£…éƒ¨ç½²

### æœ¬åœ°éƒ¨ç½²

```bash
# 1. å…‹éš†é¡¹ç›®
git clone <repository-url>
cd stock-analysis-system

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ(æ¨è)
python -m venv venv
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows

# 3. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 4. å¯åŠ¨æœåŠ¡
python main_enhanced.py

# 5. è®¿é—®æœåŠ¡
æµè§ˆå™¨æ‰“å¼€: http://localhost:8000
```

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### åŸºç¡€ä½¿ç”¨æµç¨‹

#### 1. ç”¨æˆ·ç®¡ç†

```bash
# åˆ›å»ºç”¨æˆ·
POST /users/create?user_id=user001&username=å¼ ä¸‰
```

#### 2. è‚¡ç¥¨å…³æ³¨ç®¡ç†

```bash
# æ·»åŠ å…³æ³¨
POST /watch/add?user_id=user001&stock_codes=600036,000001,600519

# æŸ¥çœ‹å…³æ³¨åˆ—è¡¨
GET /watch/list?user_id=user001

# ç§»é™¤å…³æ³¨
DELETE /watch/remove?user_id=user001&stock_code=600036
```

#### 3. æ•°æ®è·å–

```bash
# è·å–å…¨å¸‚åœºæ•°æ®
POST /data/market/fetch?force=true

# è·å–å•åªè‚¡ç¥¨å†å²æ•°æ®
POST /data/history/fetch?stock_code=600036

# è·å–åˆ†çº¢æ•°æ®
POST /data/dividend/fetch?date_str=20241115
```

#### 4. æ‰¹é‡è¡¥å……å†å²æ•°æ®

```bash
# æŸ¥çœ‹æ•°æ®çŠ¶æ€
python supplement_history.py report

# è¡¥å……ç”¨æˆ·å…³æ³¨è‚¡ç¥¨
python supplement_history.py watch --mode full

# è¡¥å……å•åªè‚¡ç¥¨
python supplement_history.py single --code 600036
```

#### 5. æ•°æ®åˆ†æ

```bash
# åˆ†æå•åªè‚¡ç¥¨
POST /analyze/stock?stock_code=600036

# æ‰¹é‡åˆ†ææ‰€æœ‰å…³æ³¨è‚¡ç¥¨
POST /analyze/manual
```

#### 6. å¯¼å‡ºç»“æœ

```bash
# å¯¼å‡ºå…¨å±€ç»“æœ
GET /export/global

# å¯¼å‡ºç”¨æˆ·ç»“æœ
GET /export/user?user_id=user001
```

### é«˜çº§åŠŸèƒ½

#### è‡ªåŠ¨åŒ–å®šæ—¶ä»»åŠ¡

ç³»ç»Ÿå¯åŠ¨åä¼šè‡ªåŠ¨é…ç½®å®šæ—¶ä»»åŠ¡:

- **æ¯æ—¥ 15:30** - è‡ªåŠ¨è·å–å…¨å¸‚åœºæ•°æ®
- **æ¯æ—¥ 16:00** - è‡ªåŠ¨åˆ†ææ‰€æœ‰å…³æ³¨è‚¡ç¥¨

#### æ•°æ®è¯Šæ–­

```bash
# è¿è¡Œè¯Šæ–­å·¥å…·
python diagnose_data.py

# æŸ¥çœ‹å­—æ®µå®Œæ•´æ€§ã€æ•°æ®é‡ç­‰ç»Ÿè®¡ä¿¡æ¯
```

---

## ğŸ“¡ APIæ–‡æ¡£

### å®Œæ•´APIåˆ—è¡¨

| ç±»åˆ« | ç«¯ç‚¹ | æ–¹æ³• | è¯´æ˜ |
|------|------|------|------|
| **ç”¨æˆ·** | `/users/create` | POST | åˆ›å»ºç”¨æˆ· |
| **å…³æ³¨** | `/watch/add` | POST | æ·»åŠ å…³æ³¨ |
| | `/watch/remove` | DELETE | ç§»é™¤å…³æ³¨ |
| | `/watch/list` | GET | æŸ¥çœ‹å…³æ³¨ |
| **æ•°æ®** | `/data/market/fetch` | POST | è·å–å¸‚åœºæ•°æ® |
| | `/data/history/fetch` | POST | è·å–å†å²æ•°æ® |
| | `/data/dividend/fetch` | POST | è·å–åˆ†çº¢æ•°æ® |
| **åˆ†æ** | `/analyze/stock` | POST | åˆ†æå•åª |
| | `/analyze/manual` | POST | æ‰¹é‡åˆ†æ |
| **å¯¼å‡º** | `/export/global` | GET | å…¨å±€å¯¼å‡º |
| | `/export/user` | GET | ç”¨æˆ·å¯¼å‡º |
| **ç³»ç»Ÿ** | `/status` | GET | ç³»ç»ŸçŠ¶æ€ |

è®¿é—®äº¤äº’å¼æ–‡æ¡£: `http://localhost:8000/docs`

---

## ğŸ—„ï¸ æ•°æ®æ¨¡å‹

### æ ¸å¿ƒæ•°æ®è¡¨

#### 1. daily_market_data - å¸‚åœºæ•°æ®

åŒ…å«20+å­—æ®µ:
- åŸºç¡€: code, name, date
- ä»·æ ¼: latest_price, high, low, open, close_prev
- æˆäº¤: volume, amount, turnover_rate
- ä¼°å€¼: pe_dynamic, pb
- å…¶ä»–: amplitude, change_pctç­‰

#### 2. historical_data - å†å²æ•°æ®

åŒ…å«11ä¸ªå­—æ®µ:
- OHLC: open, high, low, close
- æˆäº¤: volume, amount
- æŒ‡æ ‡: amplitude, turnover_rate, change_pct

#### 3. stock_analysis_results - åˆ†æç»“æœ

åŒ…å«è¯„åˆ†è¯¦æƒ…:
- ä»·æ ¼ä¼°å€¼: latest_price, pe_ratio, pb_ratio
- æ³¢åŠ¨ç‡: volatility_30d, volatility_60d
- è´¢åŠ¡: roe, profit_growth, dividend_yield
- è¯„åˆ†: volatility_score, dividend_score, growth_score
- ç»“æœ: total_score, suggestion

---

## ğŸ¯ è¯„åˆ†ç³»ç»Ÿ

### ä¸‰ç»´åº¦è¯„åˆ†ä½“ç³»(æ€»åˆ†100)

#### 1. æ³¢åŠ¨ç‡è¯„åˆ† (0-40åˆ†)

| 30æ—¥æ³¢åŠ¨ç‡ | è¯„åˆ† | è¯„ä»· |
|-----------|------|------|
| < 20% | 40åˆ† | æä½æ³¢åŠ¨ |
| 20-30% | 30åˆ† | ä½æ³¢åŠ¨ |
| 30-40% | 20åˆ† | ä¸­ç­‰æ³¢åŠ¨ |
| 40-50% | 10åˆ† | è¾ƒé«˜æ³¢åŠ¨ |
| > 50% | 0åˆ† | é«˜æ³¢åŠ¨ |

#### 2. è‚¡æ¯ç‡è¯„åˆ† (0-30åˆ†)

| è‚¡æ¯ç‡ | è¯„åˆ† | è¯„ä»· |
|--------|------|------|
| â‰¥ 5% | 30åˆ† | é«˜è‚¡æ¯ |
| â‰¥ 4% | 25åˆ† | è¾ƒé«˜è‚¡æ¯ |
| â‰¥ 3% | 20åˆ† | ä¸­ç­‰è‚¡æ¯ |
| â‰¥ 2% | 15åˆ† | ä¸€èˆ¬è‚¡æ¯ |
| â‰¥ 1% | 10åˆ† | ä½è‚¡æ¯ |

#### 3. æˆé•¿æ€§è¯„åˆ† (0-30åˆ†)

| ROE | è¯„åˆ† | è¯„ä»· |
|-----|------|------|
| > 15% | 30åˆ† | ä¼˜ç§€ |
| > 12% | 25åˆ† | è‰¯å¥½ |
| > 10% | 20åˆ† | ä¸­ç­‰ |
| > 8% | 15åˆ† | ä¸€èˆ¬ |
| > 5% | 10åˆ† | è¾ƒå·® |

### æŠ•èµ„å»ºè®®

| æ€»åˆ† | å»ºè®® |
|------|------|
| â‰¥ 70åˆ† | å¼ºçƒˆæ¨è â­â­â­â­â­ |
| 60-69åˆ† | æ¨è â­â­â­â­ |
| 50-59åˆ† | å¯ä»¥å…³æ³¨ â­â­â­ |
| 40-49åˆ† | è§‚æœ› â­â­ |
| < 40åˆ† | ä¸æ¨è â­ |

---

## â“ å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•å¼€å§‹ä½¿ç”¨?

æŒ‰ç…§[å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹)ç« èŠ‚çš„æ­¥éª¤æ“ä½œå³å¯ã€‚

### Q2: æ•°æ®åº“å­—æ®µä¸ºç©ºæ€ä¹ˆåŠ?

ä½¿ç”¨å¢å¼ºç‰ˆä»£ç  `main_enhanced.py` å¹¶é‡æ–°è·å–æ•°æ®,å­—æ®µå®Œæ•´æ€§ä¼šä»70%æå‡åˆ°95%+ã€‚

è¯¦è§: [FIELD_ENHANCEMENT.md](FIELD_ENHANCEMENT.md)

### Q3: å†å²æ•°æ®å¦‚ä½•è¡¥å……?

ä½¿ç”¨ä¸“ç”¨è¡¥å……å·¥å…·:
```bash
python supplement_history.py report  # æŸ¥çœ‹çŠ¶æ€
python supplement_history.py watch   # è¡¥å……å…³æ³¨è‚¡ç¥¨
```

è¯¦è§: [HISTORY_SUPPLEMENT_GUIDE.md](HISTORY_SUPPLEMENT_GUIDE.md)

### Q4: æ•°æ®å¤šä¹…æ›´æ–°ä¸€æ¬¡?

- å¸‚åœºæ•°æ®: æ¯æ—¥15:30è‡ªåŠ¨æ›´æ–°
- å†å²æ•°æ®: æŒ‰éœ€æ‰‹åŠ¨æ›´æ–°
- åˆ†æç»“æœ: æ¯æ—¥16:00è‡ªåŠ¨æ›´æ–°

### Q5: é‡åˆ°ç½‘ç»œé”™è¯¯æ€ä¹ˆåŠ?

è¿è¡Œç½‘ç»œè¯Šæ–­å·¥å…·:
```bash
python network_diagnostic.py
```

è¯¦è§: [TROUBLESHOOTING.md](TROUBLESHOOTING.md)

---

## ğŸ”§ å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„

```
stock-analysis-system/
â”œâ”€â”€ main_enhanced.py              # ä¸»ç¨‹åº(æ¨è)
â”œâ”€â”€ supplement_history.py         # å†å²æ•°æ®è¡¥å……å·¥å…·
â”œâ”€â”€ diagnose_data.py              # æ•°æ®è¯Šæ–­å·¥å…·
â”œâ”€â”€ requirements.txt              # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ README.md                     # æœ¬æ–‡ä»¶
â”œâ”€â”€ FIELD_ENHANCEMENT.md          # å­—æ®µä¼˜åŒ–è¯´æ˜
â”œâ”€â”€ HISTORY_SUPPLEMENT_GUIDE.md   # å†å²æ•°æ®è¡¥å……æŒ‡å—
â”œâ”€â”€ BUG_FIXES.md                  # Bugä¿®å¤è®°å½•
â”œâ”€â”€ TROUBLESHOOTING.md            # æ•…éšœæ’æŸ¥æŒ‡å—
â”œâ”€â”€ outputs/                      # å¯¼å‡ºæ–‡ä»¶ç›®å½•
â””â”€â”€ stock_advanced_system.db      # SQLiteæ•°æ®åº“
```

### æ·»åŠ æ–°åŠŸèƒ½

```python
@app.post("/your/endpoint")
async def your_function(param: str):
    """ä½ çš„å‡½æ•°è¯´æ˜"""
    # ä½ çš„é€»è¾‘
    return {"status": "success"}
```

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v2.3 (2024-02-11) - å­—æ®µå¢å¼ºç‰ˆ

**æ–°å¢**:
- âœ… å®Œæ•´å­—æ®µæ˜ å°„(20ä¸ªå­—æ®µ)
- âœ… å®æ—¶å­—æ®µå®Œæ•´æ€§ç»Ÿè®¡
- âœ… å†å²æ•°æ®å®Œæ•´ä¿å­˜(11ä¸ªå­—æ®µ)
- âœ… åŒé‡å­—æ®µè·å–ä¿éšœ

### v2.2 (2024-02-11) - Bugä¿®å¤ç‰ˆ

**ä¿®å¤**:
- âœ… CSVå¯¼å‡ºé‡å¤å®šä¹‰
- âœ… æ–‡ä»¶åæ ¼å¼åŒ–é”™è¯¯
- âœ… åˆ†çº¢æ•°æ®è·å–å‡½æ•°ç¼ºå¤±
- âœ… è‚¡æ¯ç‡/æ³¢åŠ¨ç‡è®¡ç®—å®Œå–„

### v2.1 (2024-02-10) - ç½‘ç»œä¼˜åŒ–ç‰ˆ

**æ–°å¢**:
- âœ… æ™ºèƒ½é‡è¯•æœºåˆ¶
- âœ… ç½‘ç»œä»£ç†ç¦ç”¨
- âœ… æ‰¹é‡ä¿å­˜ä¼˜åŒ–

---

## ğŸ™ è‡´è°¢

- [FastAPI](https://fastapi.tiangolo.com/)
- [AkShare](https://akshare.akfamily.xyz/)
- [efinance](https://github.com/Micro-sheep/efinance)
- [SQLAlchemy](https://www.sqlalchemy.org/)
- [APScheduler](https://apscheduler.readthedocs.io/)

---

## ğŸ“ ç›¸å…³æ–‡æ¡£

- [å­—æ®µä¼˜åŒ–è¯´æ˜](FIELD_ENHANCEMENT.md)
- [å†å²æ•°æ®è¡¥å……æŒ‡å—](HISTORY_SUPPLEMENT_GUIDE.md)
- [Bugä¿®å¤è®°å½•](BUG_FIXES.md)
- [æ•…éšœæ’æŸ¥æŒ‡å—](TROUBLESHOOTING.md)
- [ç‰ˆæœ¬å¯¹æ¯”](COMPARISON.md)

---

**å…è´£å£°æ˜**: æœ¬ç³»ç»Ÿä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨,ä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®ã€‚è‚¡å¸‚æœ‰é£é™©,æŠ•èµ„éœ€è°¨æ…ã€‚

---

Made with â¤ï¸ for Value Investors